<!DOCTYPE html>

<html>

<head>

<title>JaSON</title>

<!-- Twitter Bootstrap -->    
<link href="css/bootstrap.min.css" rel="stylesheet">

<!-- Google Pretty Printer -->
<link href="css/prettify.css" rel="stylesheet">
<script src="js/prettify.js"></script>

<!-- JQuery -->
<script src="js/jquery-1.7.1.min.js" type="text/javascript"></script>

<!--  Custom Styles -->
<style type="text/css">
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
</style>

<script type="text/javascript">
$(document).ready(function() {
	
	// enable google pretty printer
	prettyPrint();
	
	// default focus on the URL field
	$("#url").focus();
	
	$("#addHeader").click(addHeaderInput);
	
	$("#send").click(sendRequest);
	
	$(document).on("click", ".icon-remove", function() {
		$(this).parent().remove();
	});
	
});

function sendRequest() {

    // URL validation
    var url = $("#url").val();
    if (url.indexOf("http") != 0) {
        url += "http://";
    }

	$.ajax({
		"url": url,
        type: $("#method").val(),
		beforeSend: addHeadersToRequest,
		dataType: "json",
        data: $("#data").val(),
		success: function(data, textStatus, jqXHR) {
			$("#results").html(jqXHR.status + ": " +jqXHR.statusText + "\n" + jqXHR.getAllResponseHeaders() + "\n" + JSON.stringify(data, null, 2));
			$("#results").show();
		},
		error: function(jqXHR, textStatus, errorThrown) {
			$("#results").html(jqXHR.status + ": " + jqXHR.statusText);
			$("#results").show();
		}
	});
}


/**
 * Iterate through all the headers and add them to the request
 */
function addHeadersToRequest(jqXHR) {

    // TODO validate that the headers have content

    $(".header").each(function() {
		var name = $(".headerName", this).val();
        var value = $(".headerValue", this).val();
        jqXHR.setRequestHeader(name, value);
    });
}

/**
 * Add a header input field (name and value) to the page
 */
function addHeaderInput() {
	var header = $("<li class='header'><input type='text' class='headerName' placeHolder='name'/>&nbsp;<input type='text' class='headerValue' placeHolder='value'/>&nbsp;<i id='x' class='icon-remove'></i></li>");
	$("#headers").append(header);
}
</script>
</head>
    
<body>

	<!-- Navbar -->    
	<div class="navbar navbar-fixed-top">
		<div class="navbar-inner">
			<div class="container">
				<a href="#" class="brand">JaSON</a>
				<img src="icon_32.png" style="padding-top: 4px"></img>
                <ul class="nav pull-right">
					<li>
						<a href="#">About</a>
					</li>
                </ul>
			</div>
		</div>
	</div>
	
	<!-- Container -->
	<div class="container">

		<div class="row">
			<div class="control-group">
	            <div class="controls">
					<input type="text" id="url" class="span12" placeHolder="http://www.example.com/service.json"/>
					<br/>
	                <select id="method" class="span2">
						<option>GET</option>
						<option>POST</option>
						<option>PUT</option>
						<option>DELETE</option>
						<option>HEAD</option>
					</select>
	            </div>
	        </div>
	    </div>
	
		<hr />
		
		<div class="row">
		    <h3>HTTP headers</h3>
		    <ul id="headers" class="unstyled">
		    </ul>
		    <button class="btn" id="addHeader">Add new HTTP header</button>
		</div>
		
		<hr />
		
		<div class="row">
		    <h3>Request Body</h3>
		    <textarea id="data" class="span6" rows="5"></textarea>
		</div>

		<div class="row">
			<div class="form-actions">
				<input type="button" class="btn btn-primary" id="send" value="Send Request" />
			</div>
			<pre id="results" class="prettyprint lang-js" style="display:none"></pre>
		</div>
		
	</div>

</body>

</html>
