<!DOCTYPE html>

<html>

<head>

<title>JaSON</title>

<!-- Twitter Bootstrap -->    
<link href="css/bootstrap.min.css" rel="stylesheet">

<!-- Google Pretty Printer -->
<link href="css/prettify.css" rel="stylesheet">
<script src="js/prettify.js"></script>

<!-- JQuery -->
<script src="js/jquery-1.7.1.min.js" type="text/javascript"></script>

<!--  Custom Styles -->
<style type="text/css">
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
</style>

<script type="text/javascript">
$(document).ready(function() {
	
	// default focus on the URL field
	$("#url").focus();
	
	$("#addHeader").click(addHeaderInput);

	$("#addRequestParam").click(addRequestParamInput);
	
	$("#send").click(sendRequest);
	
	$(document).on("click", ".icon-remove", function() {
		$(this).parent().remove();
	});
	
});

function sendRequest() {
	
	$("#response").hide();
	$("#responseHeaders").hide();
	$("#loading").show();

    var ajaxArgs = {
		url: getURL("#url"),
        type: $("#method").val(),
    	contentType: "application/x-www-form-urlencoded",
        processData: true,
		beforeSend: processHeadersAndParams,
		dataType: "json",
        data: $("#data").val(),
		success: successResponse,
		error: errorResponse
	};

    // some things change depending on the method
    var method = $("#method").val();
    if (method == "GET") {
        ajaxArgs.data = "";
    } else if (method == "POST") {
		ajaxArgs.processData = false;
        ajaxArgs.contentType = "application/json";
    }

	$.ajax(ajaxArgs);
}

/**
 * Get a URL string from the given selector and clean it up
 * by trimming and prefixing with http if necessary.
 */
function getURL(selector) {
    var url = $(selector).val().trim();
    return url.indexOf("http") != 0 ? "http://" + url : url;
}

/**
 * Add headers and parameters to the request. 
 */
function processHeadersAndParams(jqXHR) {

	// headers
    $(".header").each(function() {
		var name = $(".name", this).val().trim();
        var value = $(".value", this).val().trim();
        
	    // TODO show an error message for headers that don't have any content
        if (name == "" || value == "") {
        	$(this).remove();
        } else {
	        jqXHR.setRequestHeader(name, value);
        }
        
    });
	
	// parameters
	$(".requestParam").each(function() {
		var name = $(".name", this).val().trim();
		var value = $(".value", this).val().trim();
		
		if (name == "" || value == "") {
			$(this).remove();
		}
		
		// TODO: add to the request
	});
}

/**
 * Called when the AJAX response returns success.
 */
function successResponse(data, textStatus, jqXHR) {
	$("#responseHeaders").html(jqXHR.status + ": " +jqXHR.statusText + "\n" + jqXHR.getAllResponseHeaders());
	$("#response").html(JSON.stringify(data, null, 2));
	prettyPrint();
	$("#loading").hide();
	$("#responseHeaders").show();
	$("#response").show();
};

/**
 * Called when the AJAX response returns an error.
 */
function errorResponse(jqXHR, textStatus, errorThrown) {
	$("#response").html(jqXHR.status + ": " + jqXHR.statusText);
	prettyPrint();
	$("#loading").hide();
	$("#response").show();
}


/**
 * Add a request header input field (name and value) to the page
 */
function addHeaderInput() {
	var header = $("<li class='header'><input type='text' class='name' placeHolder='name'/>&nbsp;<input type='text' class='value' placeHolder='value'/>&nbsp;<i class='icon-remove'></i></li>");
	$("#requestHeaders").append(header);
}

/**
 * Add a request parameter input field (name and value) to the page
 */
function addRequestParamInput() {
	var requestParamInput = $("<li class='requestParam'><input type='text' class='name' placeHolder='name'/>&nbsp;<input type='text' class='value' placeHolder='value'/>&nbsp;<i class='icon-remove'></i></li>");
	$("#requestParams").append(requestParamInput);
}

</script>
</head>
    
<body>

	<!-- Navbar -->    
	<div class="navbar navbar-fixed-top">
		<div class="navbar-inner">
			<div class="container">
				<a href="#" class="brand">JaSON</a>
				<img src="icon_32.png" style="padding-top: 4px"></img>
                <ul class="nav pull-right">
					<li>
						<a href="#">About</a>
					</li>
                </ul>
			</div>
		</div>
	</div>
	
	<!-- Container -->
	<div class="container">
	
		<!-- URL and method -->
		<div class="row">
			<div class="control-group">
	            <div class="controls">
					<input type="text" id="url" class="span6" placeHolder="http://www.example.com/service.json"/>
	                <select id="method" class="span2">
						<option>GET</option>
						<option>POST</option>
						<option>PUT</option>
						<option>DELETE</option>
						<option>HEAD</option>
					</select>
	            </div>
	        </div>
	    </div>
	
		<!-- Request Parameters -->
		<div class="row">
			<div class="control-group">
			    <h3>Request parameters</h3>
			    <ul id="requestParams" class="unstyled">
			    </ul>
			    <button class="btn" id="addRequestParam">Add request parameter</button>
		    </div>
		</div>

		<!-- Request headers -->
		<div class="row">
			<div class="control-group">
			    <h3>HTTP headers</h3>
			    <ul id="requestHeaders" class="unstyled">
			    </ul>
			    <button class="btn" id="addHeader">Add HTTP header</button>
		    </div>
		</div>
		
		<!-- Request body -->
		<div class="row">
	    	<h3>Request Body</h3>
	    	<textarea id="data" class="span6" rows="5"></textarea>
		</div>
		
		<!-- Submit and results -->
		<div class="row">
			<div class="form-actions">
				<input type="button" class="btn btn-primary" id="send" value="Send Request" />
			</div>
			
			<img id="loading" src="img/loading.gif" style="display:none" />
			<pre id="responseHeaders" class="prettyprint" style="display:none"></pre>
			<pre id="response" class="prettyprint" style="display:none"></pre>
		</div>
		
	</div>

</body>

</html>
